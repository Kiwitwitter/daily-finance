{% extends "base.html" %}

{% block title %}æœŸæƒå¸‚åœºæ—¥æŠ¥ - {{ date }}{% endblock %}

{% block content %}
<div class="report-header">
    <h2>æœŸæƒå¸‚åœºæ—¥æŠ¥</h2>
    <div class="report-date">{{ date }}</div>
</div>

<div class="report-grid">
    <!-- å¸‚åœºæ¦‚è§ˆ -->
    <section class="card">
        <h3 class="card-title">
            <span class="icon">ğŸ“ˆ</span>
            å¸‚åœºæ¦‚è§ˆ
        </h3>
        <div class="card-content">
            <div class="market-overview">
                <div class="stat-item">
                    <span class="stat-label">å…¨å¸‚åœºæˆäº¤é‡</span>
                    <span class="stat-value">{{ "{:,}".format(market_overview.total_volume) }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">çœ‹æ¶¨æœŸæƒæˆäº¤</span>
                    <span class="stat-value call">{{ "{:,}".format(market_overview.total_call_volume) }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">çœ‹è·ŒæœŸæƒæˆäº¤</span>
                    <span class="stat-value put">{{ "{:,}".format(market_overview.total_put_volume) }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">P/C æ¯”ç‡</span>
                    <span class="stat-value">{{ market_overview.pc_ratio }}</span>
                </div>
                <div class="stat-item highlight">
                    <span class="stat-label">å¸‚åœºæƒ…ç»ª</span>
                    <span class="stat-value sentiment {{ market_overview.sentiment_class }}">{{ market_overview.sentiment }}</span>
                </div>
            </div>
        </div>
    </section>

    <!-- æŒ‡æ•°æœŸæƒçœ‹æ¶¨çœ‹è·Œå æ¯” -->
    <section class="card">
        <h3 class="card-title">
            <span class="icon">ğŸ“Š</span>
            æŒ‡æ•°æœŸæƒ Call/Put å æ¯”
        </h3>
        <div class="card-content">
            {% for idx in index_options %}
            <div class="cp-bar-container">
                <span class="cp-symbol">{{ idx.symbol }}</span>
                <div class="cp-bar">
                    <div class="cp-call" style="width: {{ idx.call_pct }}%">
                        <span>{{ idx.call_pct }}%</span>
                    </div>
                    <div class="cp-put" style="width: {{ idx.put_pct }}%">
                        <span>{{ idx.put_pct }}%</span>
                    </div>
                </div>
            </div>
            {% endfor %}
            <div class="cp-legend">
                <span class="legend-call">â–  Call</span>
                <span class="legend-put">â–  Put</span>
            </div>
        </div>
    </section>

    <!-- æŒ‡æ•°æœŸæƒæˆäº¤é‡ TOP 5 -->
    <section class="card">
        <h3 class="card-title">
            <span class="icon">ğŸ†</span>
            æŒ‡æ•°æœŸæƒæˆäº¤é‡ TOP 5
        </h3>
        <div class="card-content">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>æŒ‡æ•°</th>
                        <th>æ€»æˆäº¤</th>
                        <th>Call</th>
                        <th>Put</th>
                        <th>C/Pæ¯”</th>
                    </tr>
                </thead>
                <tbody>
                    {% for idx in index_options[:5] %}
                    <tr>
                        <td class="symbol">{{ idx.symbol }}</td>
                        <td>{{ "{:,}".format(idx.total_volume) }}</td>
                        <td class="call">{{ "{:,}".format(idx.call_volume) }}</td>
                        <td class="put">{{ "{:,}".format(idx.put_volume) }}</td>
                        <td>{{ idx.cp_ratio }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

    <!-- ä¸ªè‚¡æœŸæƒæˆäº¤é‡ TOP 25 -->
    <section class="card full-width">
        <h3 class="card-title">
            <span class="icon">ğŸ”¥</span>
            ä¸ªè‚¡æœŸæƒæˆäº¤é‡ TOP 25
        </h3>
        <div class="card-content">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>è‚¡ç¥¨</th>
                        <th>æ€»æˆäº¤</th>
                        <th>Call</th>
                        <th>Put</th>
                        <th>C/Pæ¯”</th>
                        <th>æœ€çƒ­æœŸæƒ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stock in top_25_stocks %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="symbol">{{ stock.symbol }}</td>
                        <td>{{ "{:,}".format(stock.total_volume) }}</td>
                        <td class="call">{{ "{:,}".format(stock.call_volume) }}</td>
                        <td class="put">{{ "{:,}".format(stock.put_volume) }}</td>
                        <td>{{ stock.cp_ratio }}</td>
                        <td class="hottest">{{ stock.hottest_option }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

    <!-- æœŸæƒå¸‚åœºåˆ†æ -->
    {% if analysis %}
    <section class="card full-width">
        <h3 class="card-title">
            <span class="icon">ğŸ¤–</span>
            æ™ºèƒ½åˆ†æ
        </h3>
        <div class="card-content">
            <div class="analysis-content">
                {{ analysis | safe }}
            </div>
        </div>
    </section>
    {% endif %}
</div>
{% endblock %}
